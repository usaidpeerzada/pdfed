(function(){"use strict";const o={activeTabs:new Map};chrome.action.onClicked.addListener(async e=>{if(e.id)try{await i(e)?o.activeTabs.get(e.id)?(await chrome.tabs.sendMessage(e.id,{action:"HIDE_TOOLBAR"}),o.activeTabs.delete(e.id)):(await s(e.id),o.activeTabs.set(e.id,!0)):console.log("pdfed: Not a PDF page")}catch(t){console.error("pdfed error:",t)}});async function i(e){if(e.url&&e.url.toLowerCase().includes(".pdf"))return!0;try{const t=await chrome.tabs.sendMessage(e.id,{action:"CHECK_PDF"});return(t==null?void 0:t.isPDF)||!1}catch{return!1}}async function s(e){try{try{await chrome.tabs.sendMessage(e,{action:"SHOW_TOOLBAR"}),console.log("pdfed: Toolbar shown (content script already loaded)");return}catch{console.log("pdfed: Content script not found, injecting...")}await chrome.scripting.executeScript({target:{tabId:e},files:["content/index.js"]}),setTimeout(async()=>{try{await chrome.tabs.sendMessage(e,{action:"SHOW_TOOLBAR"})}catch(t){console.error("pdfed: Failed to show toolbar after injection:",t)}},100)}catch(t){console.error("Failed to inject toolbar:",t)}}chrome.tabs.onRemoved.addListener(e=>{o.activeTabs.delete(e)}),chrome.runtime.onMessage.addListener((e,t,c)=>{if(e.action==="GET_PDF_DATA"){const n=e.url||t.tab.url;return fetch(n).then(r=>{if(!r.ok)throw new Error(`Network error: ${r.status}`);return r.blob()}).then(r=>{const a=new FileReader;a.onloadend=()=>{c({success:!0,data:a.result})},a.onerror=()=>{c({success:!1,error:"Failed to read file blob"})},a.readAsDataURL(r)}).catch(r=>{console.error("PDF Fetch Error:",r),c({success:!1,error:r.message})}),!0}}),console.log("pdfed service worker initialized")})();
